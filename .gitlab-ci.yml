variables:
  VALID_EXAMPLES: "./src/test/examples/valid"
  INVALID_SEMANTIC_ERR: "./src/test/examples/invalid/semanticErr"
  INVALID_SYNTAX_ERR: "./src/test/examples/invalid/syntaxErr"
  VALID_EXAMPLES_LOG: "./log/parse_valid_error.log"
  INVALID_SEMANTIC_ERR_LOG: "./log/parse_invalid_semantic_error.log"
  INVALID_SYNTAX_ERR_LOG: "./log/parse_invalid_syntax_error.log"

stages:
  - build
  - frontend-test
  - backend-test
  - extension-test

build-job:
  stage: build
  script:
    - echo "Building the WACC compiler..."
    - make && mkdir log
  artifacts:
    paths:
      - bin
      - log

test-parser-syntax-valid: 
  stage: frontend-test
  script: 
    - echo "Using valid examples to test parser generated by ANTLR, should NOT generate any syntax error"
    - ./scripts/parserTestValid

test-parser-syntax-err: 
  stage: frontend-test
  script: 
    - echo "Using invalid examples with SYNTAX errors to test parser generated by ANTLR, SHOULD generate proper syntax error"
    - ./scripts/parserTestSynErr

test-parser-semantic-err: 
  stage: frontend-test
  script: 
    - echo "Using invalid examples with SEMANTIC errors to test parser generated by ANTLR, should NOT generate any syntax error"
    - ./scripts/parserTestSemanticErr

test-semantics-check-syntax-valid:
  stage: frontend-test
  script:
    - echo "Using valid examples to test SemanticChecker, should NOT generate any semantics error"
    - ./scripts/semanticCheckerValid

test-semantics-check-semantic-err:
  stage: frontend-test
  script:
    - echo "Using invalid examples with only semantic error to test SemanticChecker, SHOULD generate any semantics error and NOT syntax error"
    - ./scripts/semanticCheckerSemanticErr

test-execute-valid:
  stage: backend-test
  script:
    - echo "Making arm executable for each assembly file and trying to execute them..."
    - ./scripts/assembleExecuteTest
    - ./scripts/executeOutputTest
  artifacts:
    paths:
      - log/assembly
      - log/output

test-extension:
  stage: extension-test
  script:
    - echo "compile optimise sample tests and conpair with given .log result file"
    - ./scripts/constantPropagationTest.sh
    - ./scripts/extensionValidTest.sh
  artifacts:
    paths:
      - log/assembly
      - log/output

test-intel-isa:
  stage: extension-test
  script:
    - echo "compile .wacc files under intel isa"
    - ./scripts/intelAssembleExecute.sh
  artifacts:
    paths:
      - log/assembly
      - log/output